import pytest
from allennlp.common.util import ensure_list

from allennlp_eraser.common.testing import AllenNlpEraserTestCase
from allennlp_eraser.dataset_readers import (
    MoviesDatasetReader,
    MoviesEraserDatasetReader,
)


class TestMoviesEraserDatasetReader:
    @pytest.mark.parametrize("lazy", (True, False))
    def test_read_from_file_lazy(self, lazy: bool):
        reader = MoviesEraserDatasetReader(lazy=lazy)
        instances = ensure_list(reader.read("train.jsonl"))

        assert len(instances) == 1600

    @pytest.mark.parametrize(
        "file_path, num_data",
        (
            ("train.jsonl", 1600),
            ("val.jsonl", 200),
            ("val_comprehensive.jsonl", 50),
            ("test.jsonl", 200),
        ),
    )
    def test_read_from_file(self, file_path: str, num_data: int):
        reader = MoviesEraserDatasetReader(lazy=True)
        instances = ensure_list(reader.read(file_path))
        assert len(instances) == num_data


class TestMoviesDatasetReader:
    @property
    def instance_train(self):
        tokens = [
            "plot",
            ":",
            "two",
            "teen",
            "couples",
            "go",
            "to",
            "a",
            "church",
            "party",
            ",",
            "drink",
            "and",
            "then",
            "drive",
            ".",
            "they",
            "get",
            "into",
            "an",
            "accident",
            ".",
            "one",
            "of",
            "the",
            "guys",
            "dies",
            ",",
            "but",
            "his",
            "girlfriend",
            "continues",
            "to",
            "see",
            "him",
            "in",
            "her",
            "life",
            ",",
            "and",
            "has",
            "nightmares",
            ".",
            "what",
            "'s",
            "the",
            "deal",
            "?",
            "watch",
            "the",
            "movie",
            "and",
            '"',
            "sorta",
            '"',
            "find",
            "out",
            ".",
            ".",
            ".",
            "critique",
            ":",
            "a",
            "mind",
            "-",
            "fuck",
            "movie",
            "for",
            "the",
            "teen",
            "generation",
            "that",
            "touches",
            "on",
            "a",
            "very",
            "cool",
            "idea",
            ",",
            "but",
            "presents",
            "it",
            "in",
            "a",
            "very",
            "bad",
            "package",
            ".",
            "which",
            "is",
            "what",
            "makes",
            "this",
            "review",
            "an",
            "even",
            "harder",
            "one",
            "to",
            "write",
            ",",
            "since",
            "i",
            "generally",
            "applaud",
            "films",
            "which",
            "attempt",
            "to",
            "break",
            "the",
            "mold",
            ",",
            "mess",
            "with",
            "your",
            "head",
            "and",
            "such",
            "(",
            "lost",
            "highway",
            "&",
            "memento",
            ")",
            ",",
            "but",
            "there",
            "are",
            "good",
            "and",
            "bad",
            "ways",
            "of",
            "making",
            "all",
            "types",
            "of",
            "films",
            ",",
            "and",
            "these",
            "folks",
            "just",
            "did",
            "n't",
            "snag",
            "this",
            "one",
            "correctly",
            ".",
            "they",
            "seem",
            "to",
            "have",
            "taken",
            "this",
            "pretty",
            "neat",
            "concept",
            ",",
            "but",
            "executed",
            "it",
            "terribly",
            ".",
            "so",
            "what",
            "are",
            "the",
            "problems",
            "with",
            "the",
            "movie",
            "?",
            "well",
            ",",
            "its",
            "main",
            "problem",
            "is",
            "that",
            "it",
            "'s",
            "simply",
            "too",
            "jumbled",
            ".",
            "it",
            "starts",
            "off",
            '"',
            "normal",
            '"',
            "but",
            "then",
            "downshifts",
            "into",
            "this",
            '"',
            "fantasy",
            '"',
            "world",
            "in",
            "which",
            "you",
            ",",
            "as",
            "an",
            "audience",
            "member",
            ",",
            "have",
            "no",
            "idea",
            "what",
            "'s",
            "going",
            "on",
            ".",
            "there",
            "are",
            "dreams",
            ",",
            "there",
            "are",
            "characters",
            "coming",
            "back",
            "from",
            "the",
            "dead",
            ",",
            "there",
            "are",
            "others",
            "who",
            "look",
            "like",
            "the",
            "dead",
            ",",
            "there",
            "are",
            "strange",
            "apparitions",
            ",",
            "there",
            "are",
            "disappearances",
            ",",
            "there",
            "are",
            "a",
            "looooot",
            "of",
            "chase",
            "scenes",
            ",",
            "there",
            "are",
            "tons",
            "of",
            "weird",
            "things",
            "that",
            "happen",
            ",",
            "and",
            "most",
            "of",
            "it",
            "is",
            "simply",
            "not",
            "explained",
            ".",
            "now",
            "i",
            "personally",
            "do",
            "n't",
            "mind",
            "trying",
            "to",
            "unravel",
            "a",
            "film",
            "every",
            "now",
            "and",
            "then",
            ",",
            "but",
            "when",
            "all",
            "it",
            "does",
            "is",
            "give",
            "me",
            "the",
            "same",
            "clue",
            "over",
            "and",
            "over",
            "again",
            ",",
            "i",
            "get",
            "kind",
            "of",
            "fed",
            "up",
            "after",
            "a",
            "while",
            ",",
            "which",
            "is",
            "this",
            "film",
            "'s",
            "biggest",
            "problem",
            ".",
            "it",
            "'s",
            "obviously",
            "got",
            "this",
            "big",
            "secret",
            "to",
            "hide",
            ",",
            "but",
            "it",
            "seems",
            "to",
            "want",
            "to",
            "hide",
            "it",
            "completely",
            "until",
            "its",
            "final",
            "five",
            "minutes",
            ".",
            "and",
            "do",
            "they",
            "make",
            "things",
            "entertaining",
            ",",
            "thrilling",
            "or",
            "even",
            "engaging",
            ",",
            "in",
            "the",
            "meantime",
            "?",
            "not",
            "really",
            ".",
            "the",
            "sad",
            "part",
            "is",
            "that",
            "the",
            "arrow",
            "and",
            "i",
            "both",
            "dig",
            "on",
            "flicks",
            "like",
            "this",
            ",",
            "so",
            "we",
            "actually",
            "figured",
            "most",
            "of",
            "it",
            "out",
            "by",
            "the",
            "half",
            "-",
            "way",
            "point",
            ",",
            "so",
            "all",
            "of",
            "the",
            "strangeness",
            "after",
            "that",
            "did",
            "start",
            "to",
            "make",
            "a",
            "little",
            "bit",
            "of",
            "sense",
            ",",
            "but",
            "it",
            "still",
            "did",
            "n't",
            "the",
            "make",
            "the",
            "film",
            "all",
            "that",
            "more",
            "entertaining",
            ".",
            "i",
            "guess",
            "the",
            "bottom",
            "line",
            "with",
            "movies",
            "like",
            "this",
            "is",
            "that",
            "you",
            "should",
            "always",
            "make",
            "sure",
            "that",
            "the",
            "audience",
            "is",
            '"',
            "into",
            "it",
            '"',
            "even",
            "before",
            "they",
            "are",
            "given",
            "the",
            "secret",
            "password",
            "to",
            "enter",
            "your",
            "world",
            "of",
            "understanding",
            ".",
            "i",
            "mean",
            ",",
            "showing",
            "melissa",
            "sagemiller",
            "running",
            "away",
            "from",
            "visions",
            "for",
            "about",
            "20",
            "minutes",
            "throughout",
            "the",
            "movie",
            "is",
            "just",
            "plain",
            "lazy",
            "!",
            "!",
            "okay",
            ",",
            "we",
            "get",
            "it",
            ".",
            ".",
            ".",
            "there",
            "are",
            "people",
            "chasing",
            "her",
            "and",
            "we",
            "do",
            "n't",
            "know",
            "who",
            "they",
            "are",
            ".",
            "do",
            "we",
            "really",
            "need",
            "to",
            "see",
            "it",
            "over",
            "and",
            "over",
            "again",
            "?",
            "how",
            "about",
            "giving",
            "us",
            "different",
            "scenes",
            "offering",
            "further",
            "insight",
            "into",
            "all",
            "of",
            "the",
            "strangeness",
            "going",
            "down",
            "in",
            "the",
            "movie",
            "?",
            "apparently",
            ",",
            "the",
            "studio",
            "took",
            "this",
            "film",
            "away",
            "from",
            "its",
            "director",
            "and",
            "chopped",
            "it",
            "up",
            "themselves",
            ",",
            "and",
            "it",
            "shows",
            ".",
            "there",
            "might",
            "'ve",
            "been",
            "a",
            "pretty",
            "decent",
            "teen",
            "mind",
            "-",
            "fuck",
            "movie",
            "in",
            "here",
            "somewhere",
            ",",
            "but",
            "i",
            "guess",
            '"',
            "the",
            "suits",
            '"',
            "decided",
            "that",
            "turning",
            "it",
            "into",
            "a",
            "music",
            "video",
            "with",
            "little",
            "edge",
            ",",
            "would",
            "make",
            "more",
            "sense",
            ".",
            "the",
            "actors",
            "are",
            "pretty",
            "good",
            "for",
            "the",
            "most",
            "part",
            ",",
            "although",
            "wes",
            "bentley",
            "just",
            "seemed",
            "to",
            "be",
            "playing",
            "the",
            "exact",
            "same",
            "character",
            "that",
            "he",
            "did",
            "in",
            "american",
            "beauty",
            ",",
            "only",
            "in",
            "a",
            "new",
            "neighborhood",
            ".",
            "but",
            "my",
            "biggest",
            "kudos",
            "go",
            "out",
            "to",
            "sagemiller",
            ",",
            "who",
            "holds",
            "her",
            "own",
            "throughout",
            "the",
            "entire",
            "film",
            ",",
            "and",
            "actually",
            "has",
            "you",
            "feeling",
            "her",
            "character",
            "'s",
            "unraveling",
            ".",
            "overall",
            ",",
            "the",
            "film",
            "does",
            "n't",
            "stick",
            "because",
            "it",
            "does",
            "n't",
            "entertain",
            ",",
            "it",
            "'s",
            "confusing",
            ",",
            "it",
            "rarely",
            "excites",
            "and",
            "it",
            "feels",
            "pretty",
            "redundant",
            "for",
            "most",
            "of",
            "its",
            "runtime",
            ",",
            "despite",
            "a",
            "pretty",
            "cool",
            "ending",
            "and",
            "explanation",
            "to",
            "all",
            "of",
            "the",
            "craziness",
            "that",
            "came",
            "before",
            "it",
            ".",
            "oh",
            ",",
            "and",
            "by",
            "the",
            "way",
            ",",
            "this",
            "is",
            "not",
            "a",
            "horror",
            "or",
            "teen",
            "slasher",
            "flick",
            ".",
            ".",
            ".",
            "it",
            "'s",
            "just",
            "packaged",
            "to",
            "look",
            "that",
            "way",
            "because",
            "someone",
            "is",
            "apparently",
            "assuming",
            "that",
            "the",
            "genre",
            "is",
            "still",
            "hot",
            "with",
            "the",
            "kids",
            ".",
            "it",
            "also",
            "wrapped",
            "production",
            "two",
            "years",
            "ago",
            "and",
            "has",
            "been",
            "sitting",
            "on",
            "the",
            "shelves",
            "ever",
            "since",
            ".",
            "whatever",
            ".",
            ".",
            ".",
            "skip",
            "it",
            "!",
            "where",
            "'s",
            "joblo",
            "coming",
            "from",
            "?",
            "a",
            "nightmare",
            "of",
            "elm",
            "street",
            "3",
            "(",
            "7/10",
            ")",
            "-",
            "blair",
            "witch",
            "2",
            "(",
            "7/10",
            ")",
            "-",
            "the",
            "crow",
            "(",
            "9/10",
            ")",
            "-",
            "the",
            "crow",
            ":",
            "salvation",
            "(",
            "4/10",
            ")",
            "-",
            "lost",
            "highway",
            "(",
            "10/10",
            ")",
            "-",
            "memento",
            "(",
            "10/10",
            ")",
            "-",
            "the",
            "others",
            "(",
            "9/10",
            ")",
            "-",
            "stir",
            "of",
            "echoes",
            "(",
            "8/10",
            ")",
        ]

        return {"tokens": tokens, "label": "negative"}

    @property
    def instance_valid(self):
        tokens = [
            "there",
            "were",
            "four",
            "movies",
            "that",
            "earned",
            "jamie",
            "lee",
            "curtis",
            "the",
            "title",
            "of",
            '"',
            "scream",
            "queen",
            '"',
            "in",
            "the",
            "early",
            "'",
            "80s",
            ".",
            "two",
            "of",
            "them",
            "were",
            "halloween",
            "movies",
            ",",
            "but",
            "the",
            "other",
            "two",
            "--",
            "prom",
            "night",
            "and",
            "terror",
            "train",
            "--",
            "were",
            "the",
            "uninspired",
            "knockoffs",
            "that",
            "came",
            "directly",
            "after",
            "the",
            "success",
            "of",
            "halloween",
            ".",
            "the",
            "same",
            '"',
            "god",
            ",",
            "i",
            "'m",
            "scared",
            ",",
            "there",
            "'s",
            "some",
            "guy",
            "in",
            "a",
            "mask",
            "coming",
            "after",
            "me",
            '"',
            "routine",
            "she",
            "did",
            "in",
            "john",
            "carpenter",
            "'s",
            "classic",
            ",",
            "jamie",
            "lee",
            "copies",
            "here",
            ",",
            "with",
            "none",
            "of",
            "the",
            "urgency",
            "or",
            "suspense",
            ".",
            "terror",
            "train",
            "takes",
            "place",
            "on",
            "(",
            "where",
            "else",
            "?",
            ")",
            "a",
            "train",
            ",",
            "charted",
            "by",
            "some",
            "pre",
            "-",
            "med",
            "students",
            "finishing",
            "their",
            "first",
            "four",
            "years",
            "of",
            "higher",
            "education",
            ".",
            "most",
            "of",
            "them",
            "wo",
            "n't",
            "make",
            "it",
            "to",
            "med",
            "school",
            ",",
            "though",
            ",",
            "and",
            "it",
            "'s",
            "obvious",
            "from",
            "the",
            "foreshadowing",
            "done",
            "when",
            "the",
            "conductor",
            "complains",
            ",",
            '"',
            "i",
            "wish",
            "to",
            "hell",
            "they",
            "'d",
            "put",
            "a",
            "radio",
            "on",
            "that",
            "train",
            ".",
            '"',
            "the",
            "conductor",
            "character",
            "probably",
            "has",
            "the",
            "most",
            "lines",
            "of",
            "anyone",
            ",",
            "even",
            "jamie",
            "lee",
            ".",
            "from",
            "the",
            "beginning",
            ",",
            "he",
            "'s",
            "talking",
            "his",
            "head",
            "off",
            "(",
            "he",
            "tells",
            "one",
            "of",
            "his",
            "co",
            "-",
            "workers",
            '"',
            "think",
            "on",
            "this",
            "--",
            "when",
            "'s",
            "the",
            "last",
            "time",
            "someone",
            "built",
            "a",
            "shopping",
            "mall",
            "next",
            "to",
            "a",
            "train",
            "station",
            "?",
            '"',
            "as",
            "if",
            "it",
            "makes",
            "any",
            "kind",
            "of",
            "sense",
            ")",
            "and",
            "it",
            "only",
            "gets",
            "better",
            "as",
            "he",
            "engages",
            "himself",
            "in",
            "an",
            "argument",
            "about",
            "the",
            "benefits",
            "of",
            "railroad",
            "over",
            "recreational",
            "vehicles",
            ".",
            "of",
            "course",
            ",",
            "the",
            "loudmouth",
            "conductor",
            "is",
            "the",
            "first",
            "person",
            "to",
            "find",
            "a",
            "bloody",
            "body",
            ",",
            "which",
            "is",
            "then",
            "gone",
            "when",
            "he",
            "brings",
            "a",
            "skeptical",
            "trainman",
            "back",
            "to",
            "view",
            "it",
            ".",
            "i",
            "forgot",
            "to",
            "mention",
            "the",
            "prologue",
            ".",
            "it",
            "'s",
            "a",
            "party",
            "three",
            "years",
            "earlier",
            ",",
            "with",
            "the",
            "same",
            "group",
            "of",
            "students",
            ".",
            "two",
            "of",
            "them",
            "play",
            "a",
            "trick",
            "on",
            "a",
            "geeky",
            "frat",
            "pledge",
            ",",
            "promising",
            "him",
            "he",
            "'s",
            "going",
            "to",
            "get",
            "laid",
            ".",
            "they",
            "send",
            "jamie",
            "lee",
            "up",
            "to",
            "stand",
            "behind",
            "the",
            "bed",
            "and",
            "talk",
            "to",
            "the",
            "geek",
            "as",
            "he",
            "comes",
            "in",
            ",",
            "noticing",
            "a",
            "form",
            "on",
            "the",
            "bed",
            ".",
            "she",
            "says",
            ",",
            '"',
            "kiss",
            "me",
            ",",
            "kenny",
            ",",
            '"',
            "and",
            "he",
            "kisses",
            "the",
            "body",
            "on",
            "the",
            "bed",
            ",",
            "which",
            "happens",
            "to",
            "be",
            "a",
            "cadaver",
            ".",
            "(",
            '"',
            "oh",
            "my",
            "god",
            ",",
            "they",
            "killed",
            "kenny",
            "!",
            "you",
            "bastards",
            "!",
            '"',
            ")",
            "it",
            "'s",
            "a",
            "sick",
            "trick",
            ",",
            "and",
            "one",
            "jamie",
            "lee",
            "was",
            "n't",
            "let",
            "in",
            "on",
            ".",
            "she",
            "still",
            "has",
            "n't",
            "forgiven",
            "the",
            "guy",
            "as",
            "they",
            "board",
            "the",
            "terror",
            "train",
            "(",
            '"',
            "you",
            "asshole",
            ",",
            "you",
            "ca",
            "n't",
            "have",
            "a",
            "good",
            "time",
            "without",
            "hurting",
            "somebody",
            "!",
            '"',
            ")",
            ".",
            "the",
            "killing",
            "starts",
            "before",
            "the",
            "train",
            "even",
            "leaves",
            "the",
            "station",
            ".",
            "since",
            "it",
            "'s",
            "new",
            "year",
            "'s",
            ",",
            "everyone",
            "'s",
            "wearing",
            "disguises",
            "(",
            "a",
            "convenient",
            "plot",
            "device",
            "we",
            "'ve",
            "seen",
            "before",
            ")",
            ",",
            "and",
            "someone",
            "stabs",
            "the",
            "guy",
            "in",
            "the",
            "groucho",
            "mask",
            "when",
            "no",
            "one",
            "'s",
            "looking",
            ".",
            "at",
            "least",
            "one",
            "of",
            "the",
            "characters",
            "says",
            "it",
            "'s",
            "a",
            "groucho",
            "mask",
            ";",
            "when",
            "the",
            "killer",
            "dons",
            "it",
            "and",
            "steps",
            "aboard",
            ",",
            "it",
            "looks",
            "like",
            "gene",
            "shalit",
            "who",
            ",",
            "by",
            "the",
            "way",
            ",",
            "would",
            "make",
            "a",
            "great",
            "killer",
            "in",
            "a",
            "slasher",
            "movie",
            ".",
            "speaking",
            "of",
            "weird",
            "-",
            "looking",
            "dorks",
            "who",
            "still",
            "persist",
            "on",
            "the",
            "entertainment",
            "scene",
            ",",
            "one",
            "of",
            "terror",
            "train",
            "'s",
            "most",
            "famous",
            "gimmicks",
            "is",
            "the",
            "appearance",
            "of",
            "david",
            "copperfield",
            '"',
            "as",
            "the",
            "magician",
            ",",
            '"',
            "who",
            "regails",
            "those",
            "aboard",
            "with",
            "illusions",
            "set",
            "to",
            "disco",
            "music",
            ".",
            "then",
            "there",
            "'s",
            "his",
            "greatest",
            "trick",
            "--",
            "getting",
            "laid",
            "with",
            "hair",
            "that",
            "looks",
            "like",
            "that",
            ".",
            "for",
            "all",
            "its",
            "attempts",
            "at",
            "visual",
            "style",
            "and",
            "substance",
            ",",
            "terror",
            "train",
            "is",
            "more",
            "lionel",
            "than",
            "amtrak",
            ",",
            "more",
            "prom",
            "night",
            "than",
            "halloween",
            ",",
            "and",
            "nothing",
            "really",
            "worth",
            "watching",
            ".",
            "only",
            "die",
            "-",
            "hard",
            "fans",
            "of",
            "jamie",
            "lee",
            "curtis",
            "and",
            "david",
            "copperfield",
            "(",
            "if",
            "he",
            "truly",
            "has",
            "any",
            "fans",
            ")",
            "should",
            "even",
            "attempt",
            "to",
            "watch",
            "it",
            ".",
            "and",
            "it",
            "makes",
            "me",
            "wonder",
            "if",
            "a",
            "horror",
            "movie",
            "set",
            "in",
            "an",
            "rv",
            "could",
            "be",
            "much",
            "worse",
            ".",
            "i",
            "mean",
            ",",
            "when",
            "was",
            "the",
            "last",
            "time",
            "someone",
            "built",
            "a",
            "shopping",
            "mall",
            "next",
            "to",
            "a",
            "train",
            "station",
            ",",
            "anyway",
            "?",
            "terror",
            "train",
            "is",
            "definitely",
            "the",
            "cinematic",
            "equivalent",
            "of",
            "a",
            "sleeper",
            "car",
            ".",
        ]
        label = "negative"
        return {"tokens": tokens, "label": label}

    @property
    def instance_test(self):
        tokens = [
            "there",
            "may",
            "not",
            "be",
            "a",
            "critic",
            "alive",
            "who",
            "harbors",
            "as",
            "much",
            "affection",
            "for",
            "shlock",
            "monster",
            "movies",
            "as",
            "i",
            "do",
            ".",
            "i",
            "delighted",
            "in",
            "the",
            "sneaky",
            "-",
            "smart",
            "entertainment",
            "of",
            "ron",
            "underwood",
            "'s",
            "big",
            "-",
            "underground",
            "-",
            "worm",
            "yarn",
            "tremors",
            ";",
            "i",
            "even",
            "giggled",
            "at",
            "last",
            "year",
            "'s",
            "critically",
            "-",
            "savaged",
            "big",
            "-",
            "underwater",
            "-",
            "snake",
            "yarn",
            "anaconda",
            ".",
            "something",
            "about",
            "these",
            "films",
            "causes",
            "me",
            "to",
            "lower",
            "my",
            "inhibitions",
            "and",
            "return",
            "to",
            "the",
            "saturday",
            "afternoons",
            "of",
            "my",
            "youth",
            ",",
            "spent",
            "in",
            "the",
            "company",
            "of",
            "ghidrah",
            ",",
            "the",
            "creature",
            "from",
            "the",
            "black",
            "lagoon",
            "and",
            "the",
            "blob",
            ".",
            "deep",
            "rising",
            ",",
            "a",
            "big",
            "-",
            "undersea",
            "-",
            "serpent",
            "yarn",
            ",",
            "does",
            "n't",
            "quite",
            "pass",
            "the",
            "test",
            ".",
            "sure",
            "enough",
            ",",
            "all",
            "the",
            "modern",
            "monster",
            "movie",
            "ingredients",
            "are",
            "in",
            "place",
            ":",
            "a",
            "conspicuously",
            "multi",
            "-",
            "ethnic",
            "/",
            "multi",
            "-",
            "national",
            "collection",
            "of",
            "bait",
            ".",
            ".",
            ".",
            "excuse",
            "me",
            ",",
            "characters",
            ";",
            "an",
            "isolated",
            "location",
            ",",
            "here",
            "a",
            "derelict",
            "cruise",
            "ship",
            "in",
            "the",
            "south",
            "china",
            "sea",
            ";",
            "some",
            "comic",
            "relief",
            ";",
            "a",
            "few",
            "cgi",
            "-",
            "enhanced",
            "gross",
            "-",
            "outs",
            ";",
            "and",
            "at",
            "least",
            "one",
            "big",
            "explosion",
            ".",
            "there",
            "are",
            "too",
            "-",
            "cheesy",
            "-",
            "to",
            "-",
            "be",
            "-",
            "accidental",
            "elements",
            ",",
            "like",
            "a",
            "sleazy",
            "shipping",
            "magnate",
            "(",
            "anthony",
            "heald",
            ")",
            "who",
            "also",
            "appears",
            "to",
            "have",
            "a",
            "doctorate",
            "in",
            "marine",
            "biology",
            ",",
            "or",
            "a",
            "slinky",
            "international",
            "jewel",
            "thief",
            "(",
            "famke",
            "janssen",
            ")",
            "whose",
            "white",
            "cotton",
            "tank",
            "top",
            "hides",
            "a",
            "heart",
            "of",
            "gold",
            ".",
            "as",
            "it",
            "happens",
            ",",
            "deep",
            "rising",
            "is",
            "noteworthy",
            "primarily",
            "for",
            "the",
            "mechanical",
            "manner",
            "in",
            "which",
            "it",
            "spits",
            "out",
            "all",
            "those",
            "ingredients",
            ".",
            "a",
            "terrorist",
            "crew",
            ",",
            "led",
            "by",
            "squinty",
            "-",
            "eyed",
            "mercenary",
            "hanover",
            "(",
            "wes",
            "studi",
            ")",
            "and",
            "piloted",
            "by",
            "squinty",
            "-",
            "eyed",
            "boat",
            "captain",
            "finnegan",
            "(",
            "treat",
            "williams",
            ")",
            ",",
            "shows",
            "up",
            "to",
            "loot",
            "the",
            "cruise",
            "ship",
            ";",
            "the",
            "sea",
            "monsters",
            "show",
            "up",
            "to",
            "eat",
            "the",
            "mercenary",
            "crew",
            ";",
            "a",
            "few",
            "survivors",
            "make",
            "it",
            "to",
            "the",
            "closing",
            "credits",
            ".",
            "and",
            "up",
            "go",
            "the",
            "lights",
            ".",
            "it",
            "'s",
            "hard",
            "to",
            "work",
            "up",
            "much",
            "enthusiasm",
            "for",
            "this",
            "sort",
            "of",
            "joyless",
            "film",
            "-",
            "making",
            ",",
            "especially",
            "when",
            "a",
            "monster",
            "moview",
            "should",
            "make",
            "you",
            "laugh",
            "every",
            "time",
            "it",
            "makes",
            "you",
            "scream",
            ".",
            "here",
            ",",
            "the",
            "laughs",
            "are",
            "provided",
            "almost",
            "entirely",
            "by",
            "kevin",
            "j",
            ".",
            "o'connor",
            ",",
            "generally",
            "amusing",
            "as",
            "the",
            "crew",
            "'s",
            "fraidy",
            "-",
            "cat",
            "mechanic",
            ".",
            "writer",
            "/",
            "director",
            "stephen",
            "sommers",
            "seems",
            "most",
            "concerned",
            "with",
            "creating",
            "a",
            "tone",
            "of",
            "action",
            "-",
            "horror",
            "menace",
            "--",
            "something",
            "over",
            "-",
            "populated",
            "with",
            "gore",
            "-",
            "drenched",
            "skeletons",
            ",",
            "something",
            "where",
            "the",
            "gunfire",
            "and",
            "special",
            "effects",
            "are",
            "taken",
            "a",
            "bit",
            "too",
            "seriously",
            ".",
            "deep",
            "rising",
            "is",
            "missing",
            "that",
            "one",
            "unmistakable",
            "cue",
            "that",
            "we",
            "'re",
            "expected",
            "to",
            "have",
            "a",
            "ridiculous",
            "good",
            "time",
            ",",
            "not",
            "hide",
            "our",
            "eyes",
            ".",
            "case",
            "it",
            "point",
            ",",
            "comparing",
            "deep",
            "rising",
            "to",
            "its",
            "recent",
            "cousin",
            "anaconda",
            ".",
            "in",
            "deep",
            "rising",
            ",",
            "one",
            "of",
            "the",
            "creature",
            "'s",
            "victims",
            "is",
            "regurgitated",
            "back",
            "into",
            "view",
            ",",
            "partially",
            "digested",
            "and",
            "still",
            "alive",
            ".",
            "he",
            "shrieks",
            "in",
            "horror",
            "at",
            "his",
            "freakish",
            "appearance",
            "and",
            "pain",
            ",",
            "in",
            "a",
            "moment",
            "a",
            "bit",
            "too",
            "disturbing",
            "to",
            "be",
            "laughable",
            ".",
            "in",
            "anaconda",
            ",",
            "we",
            "also",
            "see",
            "a",
            "regurgitated",
            "victim",
            ",",
            "partially",
            "digested",
            "and",
            "still",
            "alive",
            ".",
            "he",
            "looks",
            "at",
            "another",
            "character",
            ".",
            ".",
            ".",
            "and",
            "winks",
            ".",
            "make",
            "no",
            "mistake",
            ",",
            "deep",
            "rising",
            "has",
            "anaconda",
            "beat",
            "all",
            "to",
            "heck",
            "when",
            "it",
            "comes",
            "to",
            "technical",
            "proficiency",
            "and",
            "pacing",
            ".",
            "it",
            "'s",
            "also",
            "gloomy",
            ",",
            "uninspired",
            "and",
            "not",
            "nearly",
            "enough",
            "fun",
            ".",
            "i",
            "do",
            "n't",
            "ask",
            "much",
            "of",
            "my",
            "monster",
            "movies",
            ",",
            "but",
            "i",
            "do",
            "ask",
            "that",
            "they",
            "act",
            "like",
            "monster",
            "movies",
            ".",
            "you",
            "do",
            "n't",
            "have",
            "to",
            "show",
            "me",
            "a",
            "fantastically",
            "impressive",
            ",",
            "massive",
            "beast",
            "with",
            "tentacles",
            "a",
            "-",
            "flailing",
            ".",
            "just",
            "show",
            "me",
            "the",
            "massive",
            "beast",
            "burping",
            ",",
            "and",
            "i",
            "'ll",
            "figure",
            "you",
            "get",
            "the",
            "point",
            ".",
        ]
        label = "negative"
        return {"tokens": tokens, "label": label}

    @pytest.mark.parametrize("lazy", (True, False))
    def test_read_from_file(self, lazy: bool):
        reader = MoviesDatasetReader(lazy=lazy)
        instances = ensure_list(reader.read("train"))
        assert len(instances) == 1600

    @pytest.mark.parametrize(
        "phase, num_data", (("train", 1600), ("valid", 200), ("test", 200))
    )
    def test_read_from_file_with_phase(self, phase: str, num_data: int):
        reader = MoviesDatasetReader(lazy=True)
        instances = ensure_list(reader.read(phase))
        assert len(instances) == num_data

        fields = instances[0].fields
        instance = getattr(self, f"instance_{phase}")
        assert [t.text for t in fields["tokens"].tokens] == instance["tokens"]
        assert fields["label"].label == instance["label"]
